<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

<link type="text/css" href="/js/jquery/css/smoothness/jquery-ui-1.7.2.custom.css" rel="stylesheet" />
<link type="text/css" href="/skins/{SYS_SKIN}/style.css" rel="stylesheet" />
<script type="text/javascript" src="/js/jquery/jquery-1.3.2.min.js"></script>
<script type="text/javascript" src="/js/jquery/jquery-ui-1.7.2.custom.min.js"></script>
<script type="text/javascript" src="/js/jquery/jquery.layout-latest.js"></script>

<style>
.submenu{
  text-align: left;
  font-weight: normal;
}
.submenu table{
  width: 100%;
  border-spacing: 0px;
}
.submenu tr{
  cursor: pointer;
}
.menuRow{
    background-color:#FFF;
}
.menuRowSelected{
    background-color:#FFF;
}
.menuRowPointer{
    background-color:#E0EAEF;
}
.submenu a{
    color:#2078A8;
    text-decoration:none;
    font-size: 11px;
}

#mainMenu {
    padding: 4px;
    padding-left: 1px;
    font-size: 12px;
    overflow: hidden;
}

#mainMenu a {
    padding: 4px;
    padding-left: 1px;
    font-size: 12px;
}
.xpadding{
   padding:5px;
   overflow: hidden;
}

#paneEastNorthContent,
#paneEastSouthContent,
#paneEastCenterContent,
#paneCenterContent{
    overflow: auto;
}

#loadPage{
    position: absolute;
    top: 200px;
    left: 200px;
}
.content {
    padding:  0px;
    position: relative;
    overflow: none;
}




/**
   *  Basic Layout Theme
   *
   *  This theme uses the default layout class-names for all classes
   *  Add any 'custom class-names', from options: paneClass, resizerClass, togglerClass
   *
   *  Download a more comprehensive stylesheet here:
   *    http://layout.jquery-dev.net/demos/css/layout-default.css
   */

  .ui-layout-pane { /* all 'panes' */
    background: #FFF;
    border: 1px solid #BBB;
    padding: 10px;
    overflow: auto;
  }

  .ui-layout-resizer { /* all 'resizer-bars' */
    background: #DDD;
  }

  .ui-layout-toggler { /* all 'toggler-buttons' */
    background: #AAA;
  }


  
</style>


<script type="text/javascript">
  var IS_FIREFOX
  var outerLayout, innerLayout;
  var oClientWinSize = parent.getClientWindowSize();

  function get_xmlhttp() {
    try {
      xmlhttp = new ActiveXObject("Msxml2.XMLHTTP");
    } 
    catch (e) {
      try {
        xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
      } catch (E) {
        xmlhttp = false;
      }
    }
    if (!xmlhttp && typeof XMLHttpRequest!='undefined') {
      xmlhttp = new XMLHttpRequest();
    }
    return xmlhttp;
  }

  $(document).ready( function() {
  var layoutSettings_Outer = {
        name: "outerLayout" // NO FUNCTIONAL USE, but could be used by custom code to 'identify' a layout
        // options.defaults apply to ALL PANES - but overridden by pane-specific settings
    , defaults: {
            size:         "auto"
        , minSize:        50
        , paneClass:        "pane"    // default = 'ui-layout-pane'
        , resizerClass:     "resizer" // default = 'ui-layout-resizer'
        , togglerClass:     "toggler" // default = 'ui-layout-toggler'
        , buttonClass:      "button"  // default = 'ui-layout-button'
        , contentSelector:    ".content"  // inner div to auto-size so only it scrolls, not the entire pane!
        , contentIgnoreSelector:  "span"    // 'paneSelector' for content to 'ignore' when measuring room for content
        , togglerLength_open:   35      // WIDTH of toggler on north/south edges - HEIGHT on east/west edges
        , togglerLength_closed: 35      // "100%" OR -1 = full height
        , hideTogglerOnSlide:   true    // hide the toggler when pane is 'slid open'
        , togglerTip_open:    "Close This Pane"
        , togglerTip_closed:    "Open This Pane"
        , resizerTip:       "Resize This Pane"
        //  effect defaults - overridden on some panes
        , fxName:         "drop"   // none, slide, drop, scale
        , fxSpeed_open:     750
        , fxSpeed_close:      1500
        , fxSettings_open:    { easing: "easeInQuint" }
        , fxSettings_close:   { easing: "easeOutQuint" }
    }
    , north: {
            spacing_open:     1     // cosmetic spacing
        , togglerLength_open:   0     // HIDE the toggler button
        , togglerLength_closed: -1      // "100%" OR -1 = full width of pane
        , resizable:        false
        , slidable:       false
        //  override default effect
        , fxName:         "none"
        }
    , south: {
            maxSize:        200
        , spacing_closed:     0     // HIDE resizer & toggler when 'closed'
        , slidable:       false   // REFERENCE - cannot slide if spacing_closed = 0
        , initClosed:       true
       
        }
    , west: {
            size:         270
        , spacing_closed:     12      // wider space when closed
        , togglerLength_closed: 12      // make toggler 'square' - 21x21
        , togglerAlign_closed:  "top"   // align to top of resizer
        , togglerLength_open:   0     // NONE - using custom togglers INSIDE west-pane
        , togglerTip_open:    "Close West Pane"
        , togglerTip_closed:    "Open West Pane"
        , resizerTip_open:    "Resize West Pane"
        , slideTrigger_open:    "default"   // default
        , initClosed:       false
        //  add 'bounce' option to default 'slide' effect
        , fxSettings_open:    { easing: "easeInQuint" }
        }
    , east: {
            size:         320
        , spacing_closed:     21      // wider space when closed
        , togglerLength_closed: 21      // make toggler 'square' - 21x21
        , togglerAlign_closed:  "top"   // align to top of resizer
        , togglerLength_open:   0       // NONE - using custom togglers INSIDE east-pane
        , togglerTip_open:    "Close East Pane"
        , togglerTip_closed:    "Open East Pane"
        , resizerTip_open:    "Resize East Pane"
        , slideTrigger_open:    "click" //slide
        , initClosed:       true
        //  override default effect, speed, and settings
        , fxName:         "drop"
        , fxSpeed:        "normal"
        , fxSettings:       { easing: "easeOutBounce" } // nullify default easing
        ,   onshow_start:     showUpdatedTriggers
        ,   onopen_start:     function () {  }


        }
    , center: {
            paneSelector:     ".ui-layout-center"       // sample: use an ID to select pane instead of a class
        , onresize:       "innerLayout.resizeAll" // resize INNER LAYOUT when center pane resizes
        , minWidth:       200
        , minHeight:        200
        }
    };
    // create the OUTER LAYOUT
    outerLayout = $("#mainPane").layout( layoutSettings_Outer );

    innerLayout = $('#paneEastContent').layout({
      center__paneSelector: ".inner-center"
    , west__paneSelector:   ".inner-west"
    , east__paneSelector:   ".inner-east"
    , north__size:    (oClientWinSize.height/3)
    , south__size:    (oClientWinSize.height/3)
    , spacing_open:   4  // ALL panes
    , spacing_closed: 4  // ALL panes
    , west__spacing_closed: 6
    , east__spacing_closed: 6
    });

        //erik 1
    var westSelector = "#mainPane > .ui-layout-west"; // outer-west pane
    var eastSelector = "#mainPane > .ui-layout-east"; // outer-east pane

     // CREATE SPANs for pin-buttons - using a generic class as identifiers
    $("<span></span>").addClass("pin-button").prependTo( westSelector );
    $("<span></span>").addClass("pin-button").prependTo( eastSelector );
    // BIND events to pin-buttons to make them functional
    outerLayout.addPinBtn( westSelector +" .pin-button", "west");
    outerLayout.addPinBtn( eastSelector +" .pin-button", "east" );

     // CREATE SPANs for close-buttons - using unique IDs as identifiers
    $("<span></span>").attr("id", "west-closer" ).prependTo( westSelector );
    $("<span></span>").attr("id", "east-closer").prependTo( eastSelector );
    // BIND layout events to close-buttons to make them functional
    outerLayout.addCloseBtn("#west-closer", "west");
    outerLayout.addCloseBtn("#east-closer", "east");

    //***//
    var sClientbrowser = navigator.userAgent.toLowerCase();
    IS_FIREFOX = false;

    if (sClientbrowser.indexOf('firefox') != -1){
        IS_FIREFOX = true;
    }

    outerLayout.hide('east');
  });


  function refreshCountFoldersTimer(){
    refreshCountFolders();
    var timer = self.setTimeout( "refreshCountFoldersTimer()", 60000 );
  }
  
  var startCaseListNumbers =new Array();
  var casesListIDs;

  $.ajax({
     type: "POST",
     url: "cases_Ajax",
     data: "action=getCountCasesFolder&A=1",
     success: function(serverResponse){
       casesListIDs = eval("(" + serverResponse + ")");
       //refreshCountFolders();
       if( '{cases_url}' == '') { 
         setTimeout("setDefaultOption()", 0);
       }
     }
  });
  var load = true;
  var ProcessNameMaxSize = 40;
  
  function refreshCountFolders(){
    if(load){
      load = false;
      for (var word in casesListIDs){                   
        if(document.getElementById('notifier_'+casesListIDs[word])){
          document.getElementById('notifier_'+casesListIDs[word]).innerHTML = '<img src="/js/maborak/core/images/loader_B.gif" border ="0" height="15">';
        }
      }
      getNotifiersContent();
    } else {
      for (var word in casesListIDs){                   
        if(document.getElementById('notifier_'+casesListIDs[word])){
          document.getElementById('notifier_'+casesListIDs[word]).innerHTML= '<b>'+document.getElementById('notifier_'+casesListIDs[word]).innerHTML+'</b>';
        }
      }
      $.ajax({
           type: "POST",
           url: "cases_Ajax",
           data: "action=getCountCasesFolder",
           success: function(serverResponse){
             objResponse = eval("(" + serverResponse + ")");
             if( typeof(objResponse) == "object") {      
                for (var word in objResponse){
                  if(!startCaseListNumbers[word]) startCaseListNumbers[word]=objResponse[word];
                  countByType="("+objResponse[word].count+")"; //+e
                  
                  if(document.getElementById('notifier_'+casesListIDs[word])){
                    document.getElementById('notifier_'+casesListIDs[word]).innerHTML = countByType;  
                  }

                  htmlSumary = '';                  
                  for (var pro_uid in objResponse[word].sumary){
                    procName = (objResponse[word].sumary[pro_uid].name.length <= ProcessNameMaxSize) ? objResponse[word].sumary[pro_uid].name: objResponse[word].sumary[pro_uid].name.substr(0, ProcessNameMaxSize)+'...';      
                    htmlSumary += procName+' ('+objResponse[word].sumary[pro_uid].count + ')<br>';
                  }
                  document.getElementById('MENU_INFO_'+casesListIDs[word]).innerHTML = htmlSumary;
                  
                }
             }
           
           }
        });
    }
  }

  function getNotifiersContent(){
    for (var word in casesListIDs){                   
      if(document.getElementById('notifier_'+casesListIDs[word])){
        document.getElementById('notifier_'+casesListIDs[word]).innerHTML= '<b>'+document.getElementById('notifier_'+casesListIDs[word]).innerHTML+'</b>';
      }
    }
    $.ajax({
       type: "POST",
       url: "cases_Ajax",
       data: "action=getCountCasesFolder",
       success: function(serverResponse){
         objResponse = eval("(" + serverResponse + ")");
         if( typeof(objResponse) == "object") {      
            for (var word in objResponse){
              if(!startCaseListNumbers[word]) startCaseListNumbers[word]=objResponse[word];
              countByType="("+objResponse[word].count+")"; //+e
            
              if(startCaseListNumbers[word]!=objResponse[word]) countByType="<b>"+countByType+"</b>";
              if(document.getElementById('notifier_'+casesListIDs[word])){
                document.getElementById('notifier_'+casesListIDs[word]).innerHTML = countByType;  

                htmlSumary = '';
                for (var pro_uid in objResponse[word].sumary){
                  procName = (objResponse[word].sumary[pro_uid].name.length <= ProcessNameMaxSize) ? objResponse[word].sumary[pro_uid].name: objResponse[word].sumary[pro_uid].name.substr(0, ProcessNameMaxSize)+'...';      
                  htmlSumary += procName+' ('+objResponse[word].sumary[pro_uid].count + ')<br>';
                }
                document.getElementById('MENU_INFO_'+casesListIDs[word]).innerHTML = htmlSumary;
              }
            }
         }
         setTimeout("getNotifiersContent()", 60000);
       }
    });
  }

  function showUpdatedTriggers(){
     // alert('showing triggers');
  }

  var PANEL_EAST_OPEN = false;


  function loading(){
    
  }
  
  /**
   * Comment
   */
  function unloading() {
    parent.document.getElementById('light').style.display='none';
    parent.document.getElementById('fade').style.display='none';
    //refreshCountFoldersTimer();
    //if( '{cases_url}' == '') setSelected(document.getElementById(oFirstRowMenuItem[0].id));
  }
    
</script>

</head>
<body onload="unloading()" onunload="loading()">
 
<div id="mainPane" style="width:100%; height:650px" class="panel_modal___processmaker">
  <div class="ui-layout-west">
     <div class="ui-accordion-header ui-helper-reset ui-state-active ui-corner-all">
       <table class="" cellspacing="0" cellpadding="2" border="0" width="100%">
         <tr>
           <td align="right"><a href="cases_New" target="casesSubFrame" class="submenu">&nbsp;{labels:ID_NEW_CASE}</a></td>
           <td width="40" align="left">
             <a href="cases_New" target="casesSubFrame" class="submenu">
               <img src="/images/plus-blue.png" width="14" height="14" border="0"/>
             </a>
           </td>
         </tr>
       </table>       
     </div>
     <div id="mainMenu">
<!-- START BLOCK : menu -->
          <h3 class="ui-accordion-header ui-helper-reset ui-state-default ui-corner-all">{blockTitle}</h3>
          <div class="ui-accordion-header ui-helper-reset ui-state-active ui-corner-all xpadding">
          
            <div class="submenu" >
              <table class="submenu" cellspacing="0" cellpadding="0">
<!-- START BLOCK : blockItem -->
                <tr onmouseout="setRowClass(this, 'menuRow')" onmouseover="setRowClass(this, 'menuRowPointer')" onclick="setSelected(this)" id="MENU_{id}">
                    <td width="10">
                        <img src="/images/{icon}"  width="22" height="22" border="0"/>
                    </td>
                    <td>
                      <a href="{link}" target="casesSubFrame" class="tableOption"> &nbsp; {label}
                        <span id="notifier_{id}"> {notifier} </span>
                     </a>
                    </td>
                </tr>
<!-- START BLOCK : blockItemSumary -->                
                <tr >
                    <td colspan="2">
                      <div  style="display:none; font-size:10px" id="MENU_INFO_{id}" class="ui-accordion-header ui-helper-reset ui-state-active ui-corner-all xpadding">
                      </div>
                    </td>
                </tr>
<!-- END BLOCK : blockItemSumary -->
<!-- END BLOCK : blockItem -->
              </table>
            </div>
          </div>
<!-- END BLOCK : menu -->
      </div>
  </div>

  <div class="ui-layout-east" id="paneEastContent">
    <div class="inner-center"    id="paneEastCenterContent"></div>
    <div class="ui-layout-north" id="paneEastNorthContent"></div>
    <div class="ui-layout-south" id="paneEastSouthContent"></div>
  </div>

  <div class="ui-layout-south"></div>

  <div class="ui-layout-center" style="background-color:#ECECEC;">
    <iframe name="casesSubFrame" id="casesSubFrame" src ="{cases_url}" width="99%" height="100" frameborder="0">
        <p>Your browser does not support iframes.</p>
    </iframe>
  </div>
</div>
</body>
<script>
var sClientbrowser = parent.getBrowserClient();

function setRowClass (theRow, thePointerClass){
  if (thePointerClass == '' || typeof(theRow.className) == 'undefined') {
      return false;
  }

  if( theRow.className != 'ui-accordion-header ui-helper-reset ui-state-default ui-corner-all' )
      theRow.className = thePointerClass;

  return true;
}


function setSelected(o){
  oTables = document.getElementsByTagName('table');

  for(i=0; i<oTables.length; i++){
      if(oTables[i].className == 'submenu'){
          var oTrs = oTables[i].getElementsByTagName('tr');

          for(j=0; j<oTrs.length; j++){
              oTrs[j].className = '';
              if(oTrs[j].id != ""){
                  //alert(oTrs[j].id);
                  document.getElementById(oTrs[j].id.replace("MENU_", "MENU_INFO_")).style.display = "none";
              }
          }
      }
  }
  setRowClass(o, 'ui-accordion-header ui-helper-reset ui-state-default ui-corner-all');
  //alert(o.id.replace("MENU_", "MENU_INFO_"));
  document.getElementById(o.id.replace("MENU_", "MENU_INFO_")).style.display = "block";
  A = o.getElementsByTagName('a');
  document.getElementById("casesSubFrame").contentWindow.location.href = A[0].href;  
}

//MSIE adapting the interface
if(sClientbrowser.browser == 'msie'){
    oDivsSubMenusIE = document.getElementsByTagName('div');
    for(i=0; i<oDivsSubMenusIE.length; i++){
        if(oDivsSubMenusIE[i].className == 'ui-accordion-header ui-helper-reset ui-state-active ui-corner-all xpadding'){
            oDivsSubMenusIE[i].style.width = '260px';
        }
    }

}

function setDefaultOption(){
  oMainMenuDiv = document.getElementById('mainMenu');
  oMenuBlocks = oMainMenuDiv.getElementsByTagName('table');
  oFirstRowMenuItem = oMenuBlocks[0].getElementsByTagName('tr');
  setSelected(document.getElementById(oFirstRowMenuItem[0].id));
}

//oMainMenuDiv = document.getElementById('mainMenu');
//oMenuBlocks = oMainMenuDiv.getElementsByTagName('table');
//oFirstRowMenuItem = oMenuBlocks[0].getElementsByTagName('tr');

//if( '{cases_url}' == '') setSelected(document.getElementById(oFirstRowMenuItem[0].id));

</script>
</html> 